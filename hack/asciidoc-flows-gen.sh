#!/bin/sh

set -e
ADOC=docs/flows-format.adoc
# TODO: pull to temp?
MD_SOURCE=../network-observability-console-plugin/web/docs

# Header
echo "// Automatically generated by '$0'. Do not edit." > $ADOC
cat ./hack/flows-format-header.adoc >> $ADOC
echo -e "\n" >> $ADOC

# Labels
kramdoc -o - $MD_SOURCE/interfaces/Labels.md \
  | sed -r 's/^= /== /' \
  | sed -r 's/Interface: //' \
  | sed -r '/Properties/d' \
  | sed -r 's~xref:.*FlowDirection\.adoc\[`FlowDirection`\]~<<Enumeration: FlowDirection,`FlowDirection`>>~' >> $ADOC

# Fields
echo -e "\n" >> $ADOC
kramdoc -o - $MD_SOURCE/interfaces/Fields.md | sed -r 's/^= /== /' | sed -r 's/Interface: //' | sed -r '/Properties/d' >> $ADOC

# FlowDirection enum
echo -e "\n" >> $ADOC
kramdoc -o - $MD_SOURCE/enums/FlowDirection.md | sed -r 's/^= /== /' | sed -r '/Enumeration Members/d' >> $ADOC
